<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>极简番茄计时器</title>
    <!-- Tailwind CSS v3 -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Font Awesome -->
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <!-- Google Fonts -->
    <style>
    @import url('https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;1,100;1,200;1,300;1,400;1,500;1,600;1,700&display=swap');
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&display=swap');
    </style>
    <!-- 统一的 Tailwind 配置 -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#B52B2D',
                        secondary: '#10b981',
                        neutral: '#312828',
                        light: '#F9F9F5',
                        dark: '#111827'
                    },
                    fontFamily: {
                    inter: ['Inter', 'sans-serif'],
                    },
                    animation: {
                        'pulse-slow': 'pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                        'fade-in': 'fadeIn 0.5s ease-in-out',
                    },
                    keyframes: {
                        fadeIn: {
                            '0%': { opacity: '0' },
                            '100%': { opacity: '1' },
                        }
                    }
                }
            }
        }
    </script>
    <style type="text/tailwindcss">
        @layer utilities {
            .text-shadow {
                text-shadow: 0 2px 4px rgba(0,0,0,0.1);
            }
            .transition-all-300 {
                transition: all 300ms ease-in-out;
            }
            .bg-gradient-work {
                background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
            }
            .bg-gradient-break {
                background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            }
            .timer-ring {
                transition: stroke-dashoffset 1s linear;
                transform: rotate(-90deg);
                transform-origin: 50% 50%;
            }
            .card-hover {
                transition: transform 0.3s ease, box-shadow 0.3s ease;
            }
            .card-hover:hover {
                transform: translateY(-5px);
                box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
            }
        }
    </style>
</head>
<body class="bg-light min-h-screen flex flex-col items-center justify-center p-4 pt-16 transition-all duration-500 font-inter">
    <!-- 右上角时间和日历 -->
    <div id="datetime-display" class="absolute top-4 right-4 bg-white/80 backdrop-blur-sm rounded-lg p-3 shadow-md text-neutral text-right">
        <div id="current-time" class="text-lg font-medium"></div>
        <div id="current-date" class="text-sm text-gray-500"></div>
    </div>

    <div class="max-w-md w-full mx-auto flex flex-col items-center">
        <!-- 标题 -->
        <h1 class="font-serif font-bold text-3xl text-neutral mb-8 text-center animate-fade-in" style="font-size: 36px;">番茄工作法</h1>
        
        <!-- 计时器容器 -->
        <div class="relative mb-4 w-64 h-64">
            <!-- SVG 圆环 -->
            <svg class="w-full h-full" viewBox="0 0 100 100">
                <!-- 背景圆环 -->
                <circle cx="50" cy="50" r="45" fill="none" stroke="#DFDED7" stroke-width="4"></circle>
                
                <!-- 进度圆环 -->
                <circle id="timer-ring" class="timer-ring cx-50 cy-50 r-45 fill-none stroke-primary stroke-4" stroke-dasharray="282.74" stroke-dashoffset="0"></circle>
            </svg>
            
            <!-- 计时器显示 -->
            <div class="absolute inset-0 flex flex-col items-center justify-center">
                <span id="timer-display" class="font-serif text-5xl font-bold text-neutral" style="font-weight: normal; font-size: 48px; color: rgb(176, 58, 58);">25:00</span>
                <span id="timer-status" class="text-lg text-gray-500 mt-2" style="font-size: 13px; color: rgb(179, 177, 170);">准备开始工作</span>
            </div>
        </div>
        
        <!-- 控制按钮 -->
        <div class="flex space-x-4 mb-8">
            <button id="start-btn" class="px-6 py-3 bg-primary text-white rounded-full hover:bg-primary/90 transition-all-300 flex items-center shadow-md hover:shadow-lg">
                <i class="fa fa-play mr-2"></i> 开始
            </button>
            <button id="reset-btn" class="px-6 py-3 bg-gray-200 text-neutral rounded-full hover:bg-gray-300 transition-all-300 flex items-center shadow-sm hover:shadow">
                <i class="fa fa-refresh mr-2"></i> 重置
            </button>
        </div>
        
        <!-- 模式切换 -->
        <div class="flex justify-center mb-4 w-full">
            <div class="inline-flex rounded-full shadow-sm" role="group">
                <button id="work-mode" class="px-6 py-2 text-sm font-medium bg-primary text-white rounded-l-full hover:bg-primary/90 focus:z-10 transition-all-300" style="font-size: 14px; font-weight: normal;">工作模式</button>
                <button id="break-mode" class="px-6 py-2 text-sm font-medium bg-gray-200 text-neutral rounded-r-full hover:bg-secondary focus:z-10 transition-all-300" style="font-weight: normal;">休息模式</button>
            </div>
        </div>
        
        <!-- 轻音乐播放器 -->
        <div class="w-full bg-white rounded-lg shadow-sm p-4 mb-4">
            <h3 class="text-md font-medium text-neutral mb-3">轻音乐</h3>
            <div class="space-y-3">
                <div class="flex items-center justify-between bg-light p-3 rounded-lg">
                    <div class="flex items-center">
                        <i class="fa fa-music text-primary mr-3"></i>
                        <span>轻松钢琴</span>
                    </div>
                    <button class="play-music px-3 py-1 bg-primary/10 text-primary rounded-full hover:bg-primary/20 transition-all-300" data-src="https://www.soundhelix.com/examples/mp3/SoundHelix-Song-1.mp3">
                        <i class="fa fa-play"></i>
                    </button>
                </div>
                <div class="flex items-center justify-between bg-light p-3 rounded-lg">
                    <div class="flex items-center">
                        <i class="fa fa-music text-primary mr-3"></i>
                        <span>自然雨声</span>
                    </div>
                    <button class="play-music px-3 py-1 bg-primary/10 text-primary rounded-full hover:bg-primary/20 transition-all-300" data-src="https://www.soundhelix.com/examples/mp3/SoundHelix-Song-2.mp3">
                        <i class="fa fa-play"></i>
                    </button>
                </div>
                <div>
                    <input type="file" id="music-upload" accept="audio/*" class="hidden">
                    <label for="music-upload" class="inline-flex items-center text-sm text-primary hover:text-primary/80 cursor-pointer transition-all-300">
                        <i class="fa fa-upload mr-1"></i> 上传音乐
                    </label>
                </div>
            </div>
        </div>
        
        <!-- 视频上传区域 -->
        <div class="w-full bg-white rounded-lg shadow-sm p-4 mb-4">
            <h3 class="text-md font-medium text-neutral mb-3">视频上传</h3>
            <div class="border-2 border-dashed border-gray-200 rounded-lg p-4 text-center hover:border-primary transition-all-300">
                <input type="file" id="video-upload" accept="video/*" class="hidden">
                <label for="video-upload" class="cursor-pointer">
                    <i class="fa fa-film text-3xl text-gray-400 mb-2"></i>
                    <p class="text-sm text-gray-500">点击或拖拽视频文件到此处上传</p>
                </label>
                <div id="uploaded-videos" class="mt-3 hidden">
                    <h4 class="text-sm font-medium text-neutral mb-2">已上传视频</h4>
                    <div id="videos-list" class="space-y-2"></div>
                </div>
            </div>
        </div>
        
        <!-- 设置与统计 -->
        <div class="w-full bg-white rounded-lg shadow-sm p-4 card-hover">
            <!-- 自定义设置 -->
            <div class="mb-6">
                <h3 class="text-md font-medium text-neutral mb-3">自定义时间</h3>
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label for="work-time" class="block text-sm font-medium text-gray-700 mb-1" style="font-weight: normal; font-size: 13px;">工作时间 (分钟)</label>
                        <input type="number" id="work-time" class="font-serif w-full px-3 py-2 border border-gray-200 rounded-full focus:outline-none focus:ring-2 focus:ring-primary/50" value="25" min="1" max="60">
                    </div>
                    <div>
                        <label for="break-time" class="block text-sm font-medium text-gray-700 mb-1" style="font-weight: normal; font-size: 13px;">休息时间 (分钟)</label>
                        <input type="number" id="break-time" class="font-serif w-full px-3 py-2 border border-gray-200 rounded-full focus:outline-none focus:ring-2 focus:ring-primary/50" value="5" min="1" max="30">
                    </div>
                </div>
            </div>
            
            <!-- 分隔线 -->
            <div class="border-t border-gray-100 my-3"></div>
            
            <!-- 统计信息 -->
            <div>
                <h3 class="text-md font-medium text-neutral mb-3">今日统计</h3>
                <div class="flex justify-between items-center">
                    <div class="text-center">
                        <p class="text-sm text-gray-500" style="color: rgb(55, 65, 81); font-size: 13px;">已完成番茄数</p>
                        <p id="completed-pomodoros" class="font-serif text-2xl font-bold text-neutral" style="font-size: 18px; font-weight: normal;">0</p>
                    </div>
                    <div class="text-center">
                        <p class="text-sm text-gray-500" style="color: rgb(55, 65, 81); font-size: 13px;">专注时间</p>
                        <p id="focus-time" class="font-serif text-2xl font-bold text-neutral" style="font-size: 18px; font-weight: normal;">0</p>
                    </div>
                    <div class="text-center">
                        <p class="text-sm text-gray-500" style="color: rgb(55, 65, 81); font-size: 13px;">番茄积分</p>
                        <p id="pomodoro-points" class="font-serif text-2xl font-bold text-primary" style="font-size: 18px; font-weight: normal;">0</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- 奖励商店按钮 -->
    <button id="rewards-btn" class="mt-4 px-6 py-3 bg-secondary text-white rounded-full hover:bg-green-600 transition-all-300 flex items-center shadow-md hover:shadow-lg">
        <i class="fa fa-gift mr-2"></i> 奖励商店
    </button>
    
    <!-- 奖励商店模态框 -->
    <div id="rewards-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden animate-fade-in">
        <div class="bg-white rounded-lg shadow-xl p-6 max-w-md w-full mx-4 max-h-[80vh] overflow-y-auto">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-2xl font-bold text-neutral">番茄奖励商店</h2>
                <button id="close-rewards" class="text-gray-500 hover:text-gray-700 transition-all-300">
                    <i class="fa fa-times text-xl"></i>
                </button>
            </div>
            
            <div class="mb-4">
                <div class="flex items-center justify-between bg-light p-3 rounded-lg">
                    <div class="flex items-center">
                        <img src="https://p3-doubao-search-sign.byteimg.com/labis/eafec4e38a23595fa8339e9fb0a32d8a~tplv-be4g95zd3a-image.jpeg?rk3s=542c0f93&x-expires=1779190655&x-signature=1PLNiCri7IDVMQtj%2Bv2T5Ur1tsI%3D" alt="积分" class="w-8 h-8 mr-2">
                        <span class="text-lg font-medium">我的积分</span>
                    </div>
                    <span id="modal-points" class="text-xl font-bold text-primary">0</span>
                </div>
            </div>
            
            <h3 class="text-lg font-medium text-neutral mb-3">心仪物品</h3>
            <div id="items-container" class="grid grid-cols-2 gap-4 mb-6">
                <!-- 物品将通过JavaScript动态添加 -->
            </div>
            
            <h3 class="text-lg font-medium text-neutral mb-3">美味食物</h3>
            <div id="food-container" class="grid grid-cols-2 gap-4 mb-6">
                <!-- 食物将通过JavaScript动态添加 -->
            </div>
            
            <h3 class="text-lg font-medium text-neutral mb-3">已兑换奖励</h3>
            <div id="redeemed-container" class="bg-light p-4 rounded-lg min-h-[100px]">
                <p id="no-redeemed" class="text-gray-500 text-center">还没有兑换任何奖励</p>
                <div id="redeemed-list" class="hidden">
                    <!-- 已兑换的奖励将通过JavaScript动态添加 -->
                </div>
            </div>
        </div>
    </div>
    
    <!-- 兑换成功提示 -->
    <div id="success-toast" class="fixed bottom-4 left-1/2 transform -translate-x-1/2 bg-green-500 text-white px-6 py-3 rounded-lg shadow-lg hidden animate-fade-in">
        <div class="flex items-center">
            <i class="fa fa-check-circle mr-2"></i>
            <span>兑换成功！</span>
        </div>
    </div>

    <script>
        // 音频元素
        let currentAudio = null;
        
        // 状态变量
        let timer = null;
        let isRunning = false;
        let isWorkMode = true;
        let timeLeft = 25 * 60; // 默认25分钟（秒）
        let workTime = 25 * 60; // 工作时间（秒）
        let breakTime = 5 * 60; // 休息时间（秒）
        
        // 统计数据
        let completedPomodoros = 0;
        let focusTime = 0;
        let currentStreak = 0;
        let pomodoroPoints = 0;
        
        // 奖励数据（积分翻倍）
        const rewards = {
            items: [
                { id: 1, name: '新手机', points: 1000, image: 'https://p26-doubao-search-sign.byteimg.com/labis/816b3a1b739b98ce17f23498ed7850f2~tplv-be4g95zd3a-image.jpeg?rk3s=542c0f93&x-expires=1779190655&x-signature=j8qBnOOK%2BoVDa%2FG55AqYaLNC700%3D' },
                { id: 2, name: '耳机', points: 600, image: 'https://p3-doubao-search-sign.byteimg.com/tos-cn-i-be4g95zd3a/1017357605061263416~tplv-be4g95zd3a-image.jpeg?rk3s=542c0f93&x-expires=1779190655&x-signature=UDgCT1A12r0Y5Qwc5I4G5uEN%2Bsw%3D' },
                { id: 3, name: '书籍', points: 200, image: 'https://p3-doubao-search-sign.byteimg.com/tos-cn-i-be4g95zd3a/1017357605061263416~tplv-be4g95zd3a-image.jpeg?rk3s=542c0f93&x-expires=1779190655&x-signature=UDgCT1A12r0Y5Qwc5I4G5uEN%2Bsw%3D' },
                { id: 4, name: '手表', points: 400, image: 'https://p3-doubao-search-sign.byteimg.com/tos-cn-i-be4g95zd3a/1006037746406916181~tplv-be4g95zd3a-image.jpeg?rk3s=542c0f93&x-expires=1779190655&x-signature=tCC1yl%2BNeNU4TxialDbvWQjWGK0%3D' }
            ],
            food: [
                { id: 5, name: '冰淇淋', points: 100, image: 'https://p26-doubao-search-sign.byteimg.com/tos-cn-i-be4g95zd3a/1011022227767033922~tplv-be4g95zd3a-image.jpeg?rk3s=542c0f93&x-expires=1779190655&x-signature=clJnPgCniuq7yi2t9yFs8srjEws%3D' },
                { id: 6, name: '咖啡', points: 60, image: 'https://p26-doubao-search-sign.byteimg.com/tos-cn-i-be4g95zd3a/1009933702667960409~tplv-be4g95zd3a-image.jpeg?rk3s=542c0f93&x-expires=1779190655&x-signature=X%2B0aIZRVVol6dvtOEjNJiALLh7w%3D' },
                { id: 7, name: '水果', points: 40, image: 'https://p26-doubao-search-sign.byteimg.com/labis/9fea71ef930d96836e71d4faddfc155b~tplv-be4g95zd3a-image.jpeg?rk3s=542c0f93&x-expires=1779190655&x-signature=u5sW1RvNWTX%2BAH82s1vkIADW5D4%3D' },
                { id: 8, name: '蛋糕', points: 80, image: 'https://p26-doubao-search-sign.byteimg.com/tos-cn-i-be4g95zd3a/1009933702667960409~tplv-be4g95zd3a-image.jpeg?rk3s=542c0f93&x-expires=1779190655&x-signature=X%2B0aIZRVVol6dvtOEjNJiALLh7w%3D' }
            ],
            redeemed: []
        };
        
        // DOM 元素
        const timerDisplay = document.getElementById('timer-display');
        const timerStatus = document.getElementById('timer-status');
        const timerRing = document.getElementById('timer-ring');
        const startBtn = document.getElementById('start-btn');
        const resetBtn = document.getElementById('reset-btn');
        const workModeBtn = document.getElementById('work-mode');
        const breakModeBtn = document.getElementById('break-mode');
        const workTimeInput = document.getElementById('work-time');
        const breakTimeInput = document.getElementById('break-time');
        const completedPomodorosEl = document.getElementById('completed-pomodoros');
        const focusTimeEl = document.getElementById('focus-time');
        const currentStreakEl = document.getElementById('current-streak');
        const pomodoroPointsEl = document.getElementById('pomodoro-points');
        const modalPointsEl = document.getElementById('modal-points');
        const rewardsBtn = document.getElementById('rewards-btn');
        const rewardsModal = document.getElementById('rewards-modal');
        const closeRewardsBtn = document.getElementById('close-rewards');
        const itemsContainer = document.getElementById('items-container');
        const foodContainer = document.getElementById('food-container');
        const redeemedContainer = document.getElementById('redeemed-container');
        const noRedeemedEl = document.getElementById('no-redeemed');
        const redeemedListEl = document.getElementById('redeemed-list');
        const successToast = document.getElementById('success-toast');
        const currentTimeEl = document.getElementById('current-time');
        const currentDateEl = document.getElementById('current-date');
        const musicButtons = document.querySelectorAll('.play-music');
        const musicUpload = document.getElementById('music-upload');
        const videoUpload = document.getElementById('video-upload');
        const uploadedVideos = document.getElementById('uploaded-videos');
        const videosList = document.getElementById('videos-list');
        
        // 更新日期和时间
        function updateDateTime() {
            const now = new Date();
            // 时间格式: HH:MM:SS
            currentTimeEl.textContent = now.toLocaleTimeString();
            // 日期格式: YYYY年MM月DD日 星期X
            const options = { year: 'numeric', month: 'long', day: 'numeric', weekday: 'long' };
            currentDateEl.textContent = now.toLocaleDateString('zh-CN', options);
        }
        
        // 初始化日期时间显示并每秒更新
        updateDateTime();
        setInterval(updateDateTime, 1000);
        
        // 音乐播放控制
        musicButtons.forEach(button => {
            button.addEventListener('click', function() {
                const src = this.getAttribute('data-src');
                
                // 停止当前播放的音频
                if (currentAudio) {
                    currentAudio.pause();
                    document.querySelectorAll('.play-music i').forEach(icon => {
                        icon.className = 'fa fa-play';
                    });
                }
                
                if (currentAudio && currentAudio.src.includes(src)) {
                    currentAudio = null;
                    return;
                }
                
                // 播放新的音频
                currentAudio = new Audio(src);
                currentAudio.play();
                this.querySelector('i').className = 'fa fa-pause';
                
                // 音频结束时更新按钮状态
                currentAudio.addEventListener('ended', () => {
                    this.querySelector('i').className = 'fa fa-play';
                    currentAudio = null;
                });
            });
        });
        
        // 音乐上传处理
        musicUpload.addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (file) {
                const audioUrl = URL.createObjectURL(file);
                const musicContainer = document.querySelector('.space-y-3');
                
                const newMusicEl = document.createElement('div');
                newMusicEl.className = 'flex items-center justify-between bg-light p-3 rounded-lg animate-fade-in';
                newMusicEl.innerHTML = `
                    <div class="flex items-center">
                        <i class="fa fa-music text-primary mr-3"></i>
                        <span>${file.name}</span>
                    </div>
                    <button class="play-music px-3 py-1 bg-primary/10 text-primary rounded-full hover:bg-primary/20 transition-all-300" data-src="${audioUrl}">
                        <i class="fa fa-play"></i>
                    </button>
                `;
                
                musicContainer.insertBefore(newMusicEl, musicContainer.lastElementChild);
                
                // 添加事件监听
                newMusicEl.querySelector('.play-music').addEventListener('click', function() {
                    const src = this.getAttribute('data-src');
                    
                    if (currentAudio) {
                        currentAudio.pause();
                        document.querySelectorAll('.play-music i').forEach(icon => {
                            icon.className = 'fa fa-play';
                        });
                    }
                    
                    if (currentAudio && currentAudio.src.includes(src)) {
                        currentAudio = null;
                        return;
                    }
                    
                    currentAudio = new Audio(src);
                    currentAudio.play();
                    this.querySelector('i').className = 'fa fa-pause';
                    
                    currentAudio.addEventListener('ended', () => {
                        this.querySelector('i').className = 'fa fa-play';
                        currentAudio = null;
                    });
                });
                
                // 重置input，允许重复上传同一文件
                this.value = '';
            }
        });
        
        // 视频上传处理
        videoUpload.addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (file) {
                const videoUrl = URL.createObjectURL(file);
                
                // 显示已上传视频区域
                uploadedVideos.classList.remove('hidden');
                
                // 创建视频元素
                const videoEl = document.createElement('div');
                videoEl.className = 'bg-light p-2 rounded-lg animate-fade-in';
                videoEl.innerHTML = `
                    <video controls class="w-full rounded" poster="https://via.placeholder.com/150?text=Video+Thumbnail">
                        <source src="${videoUrl}" type="${file.type}">
                        您的浏览器不支持视频播放
                    </video>
                    <p class="text-xs text-gray-500 mt-1">${file.name}</p>
                `;
                
                videosList.appendChild(videoEl);
                
                // 重置input
                this.value = '';
            }
        });
        
        // 初始化圆环
        const ringRadius = timerRing.r.baseVal.value;
        const ringCircumference = 2 * Math.PI * ringRadius;
        timerRing.style.strokeDasharray = ringCircumference;
        updateRingProgress(1); // 初始化为满进度
        
        // 格式化时间（秒 -> MM:SS）
        function formatTime(seconds) {
            const mins = Math.floor(seconds / 60);
            const secs = seconds % 60;
            return `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
        }
        
        // 更新圆环进度
        function updateRingProgress(progress) {
            const offset = ringCircumference * (1 - progress);
            timerRing.style.strokeDashoffset = offset;
        }
        
        // 更新计时器显示
        function updateTimerDisplay() {
            timerDisplay.textContent = formatTime(timeLeft);
            
            // 计算进度
            const totalTime = isWorkMode ? workTime : breakTime;
            const progress = timeLeft / totalTime;
            updateRingProgress(progress);
            
            // 更新状态文本
            timerStatus.textContent = isRunning 
                ? (isWorkMode ? '专注工作中...' : '休息放松中...') 
                : (isWorkMode ? '准备开始工作' : '准备开始休息');
        }
        
        // 切换模式
        function toggleMode(mode) {
            if (isRunning) return; // 运行时不允许切换模式
            
            isWorkMode = mode === 'work';
            timeLeft = isWorkMode ? workTime : breakTime;
            
            // 更新UI
            if (isWorkMode) {
                workModeBtn.classList.remove('bg-gray-200', 'text-neutral');
                workModeBtn.classList.add('bg-primary', 'text-white');
                breakModeBtn.classList.remove('bg-secondary', 'text-white');
                breakModeBtn.classList.add('bg-gray-200', 'text-neutral');
                timerRing.classList.remove('stroke-secondary');
                timerRing.classList.add('stroke-primary');
            } else {
                breakModeBtn.classList.remove('bg-gray-200', 'text-neutral');
                breakModeBtn.classList.add('bg-secondary', 'text-white');
                workModeBtn.classList.remove('bg-primary', 'text-white');
                workModeBtn.classList.add('bg-gray-200', 'text-neutral');
                timerRing.classList.remove('stroke-primary');
                timerRing.classList.add('stroke-secondary');
            }
            
            updateTimerDisplay();
        }
        
        // 开始/暂停计时器
        function toggleTimer() {
            if (isRunning) {
                // 暂停计时器
                clearInterval(timer);
                startBtn.innerHTML = '<i class="fa fa-play mr-2"></i> 继续';
                timerStatus.textContent = isWorkMode ? '工作已暂停' : '休息已暂停';
            } else {
                // 开始计时器
                timer = setInterval(() => {
                    timeLeft--;
                    
                    if (timeLeft <= 0) {
                        // 计时结束
                        clearInterval(timer);
                        isRunning = false;
                        startBtn.innerHTML = '<i class="fa fa-play mr-2"></i> 开始';
                        
                        // 播放提示音
                        const audio = new Audio('https://assets.mixkit.co/sfx/preview/mixkit-alarm-digital-clock-beep-989.mp3');
                        audio.play();
                        
                        if (isWorkMode) {
                            // 工作计时结束，切换到休息模式
                            completedPomodoros++;
                            focusTime += workTime / 60;
                            currentStreak++;
                            // 每完成一个番茄工作，获得20积分（翻倍）
                            pomodoroPoints += 20;
                            updateStats();
                            
                            // 显示完成动画
                            showCompletionAnimation();
                            
                            timerStatus.textContent = '工作完成！获得20积分';
                            setTimeout(() => {
                                toggleMode('break');
                            }, 2000);
                        } else {
                            // 休息计时结束，切换到工作模式
                            timerStatus.textContent = '休息结束！开始新的工作吧';
                            setTimeout(() => {
                                toggleMode('work');
                            }, 2000);
                        }
                    }
                    
                    updateTimerDisplay();
                }, 1000);
                
                startBtn.innerHTML = '<i class="fa fa-pause mr-2"></i> 暂停';
            }
            
            isRunning = !isRunning;
        }
        
        // 重置计时器
        function resetTimer() {
            clearInterval(timer);
            isRunning = false;
            timeLeft = isWorkMode ? workTime : breakTime;
            startBtn.innerHTML = '<i class="fa fa-play mr-2"></i> 开始';
            updateTimerDisplay();
        }
        
        // 更新统计数据
        function updateStats() {
            completedPomodorosEl.textContent = completedPomodoros;
            focusTimeEl.textContent = `${focusTime}分钟`;
            // currentStreakEl.textContent = currentStreak;
            pomodoroPointsEl.textContent = pomodoroPoints;
            modalPointsEl.textContent = pomodoroPoints;
            
            // 保存到本地存储
            localStorage.setItem('pomodoroStats', JSON.stringify({
                completedPomodoros,
                focusTime,
                currentStreak,
                pomodoroPoints
            }));
        }
        
        // 加载保存的统计数据
        function loadStats() {
            const savedStats = localStorage.getItem('pomodoroStats');
            if (savedStats) {
                const stats = JSON.parse(savedStats);
                completedPomodoros = stats.completedPomodoros || 0;
                focusTime = stats.focusTime || 0;
                currentStreak = stats.currentStreak || 0;
                pomodoroPoints = stats.pomodoroPoints || 0;
                updateStats();
            }
            
            // 加载已兑换的奖励
            const savedRewards = localStorage.getItem('pomodoroRewards');
            if (savedRewards) {
                rewards.redeemed = JSON.parse(savedRewards);
                renderRedeemedRewards();
            }
        }
        
        // 更新时间设置
        function updateTimeSettings() {
            workTime = parseInt(workTimeInput.value) * 60;
            breakTime = parseInt(breakTimeInput.value) * 60;
            
            // 如果当前不在运行状态，更新剩余时间
            if (!isRunning) {
                timeLeft = isWorkMode ? workTime : breakTime;
                updateTimerDisplay();
            }
            
            // 保存到本地存储
            localStorage.setItem('pomodoroSettings', JSON.stringify({
                workTime: workTime / 60,
                breakTime: breakTime / 60
            }));
        }
        
        // 加载保存的设置
        function loadSettings() {
            const savedSettings = localStorage.getItem('pomodoroSettings');
            if (savedSettings) {
                const settings = JSON.parse(savedSettings);
                workTime = settings.workTime * 60;
                breakTime = settings.breakTime * 60;
                workTimeInput.value = settings.workTime;
                breakTimeInput.value = settings.breakTime;
                
                // 更新剩余时间
                if (!isRunning) {
                    timeLeft = isWorkMode ? workTime : breakTime;
                    updateTimerDisplay();
                }
            }
        }
        
        // 显示完成动画
        function showCompletionAnimation() {
            const timerContainer = document.querySelector('.relative.mb-4');
            timerContainer.classList.add('animate-pulse-slow');
            setTimeout(() => {
                timerContainer.classList.remove('animate-pulse-slow');
            }, 2000);
        }
        
        // 渲染奖励商店
        function renderRewardsStore() {
            // 渲染物品
            itemsContainer.innerHTML = '';
            rewards.items.forEach(item => {
                const itemEl = document.createElement('div');
                itemEl.className = 'bg-light rounded-lg p-3 flex flex-col items-center card-hover';
                itemEl.innerHTML = `
                    <img src="${item.image}" alt="${item.name}" class="w-16 h-16 object-contain mb-2">
                    <h4 class="text-sm font-medium text-center">${item.name}</h4>
                    <div class="flex items-center mt-1">
                        <img src="https://p3-doubao-search-sign.byteimg.com/labis/eafec4e38a23595fa8339e9fb0a32d8a~tplv-be4g95zd3a-image.jpeg?rk3s=542c0f93&x-expires=1779190655&x-signature=1PLNiCri7IDVMQtj%2Bv2T5Ur1tsI%3D" alt="积分" class="w-4 h-4 mr-1">
                        <span class="text-xs">${item.points}</span>
                    </div>
                    <button class="mt-2 px-3 py-1 bg-primary text-white text-xs rounded-full hover:bg-red-700 transition-all-300 ${pomodoroPoints < item.points ? 'opacity-50 cursor-not-allowed' : ''}" 
                            onclick="redeemReward(${item.id})" ${pomodoroPoints < item.points ? 'disabled' : ''}>
                        兑换
                    </button>
                `;
                itemsContainer.appendChild(itemEl);
            });
            
            // 渲染食物
            foodContainer.innerHTML = '';
            rewards.food.forEach(item => {
                const itemEl = document.createElement('div');
                itemEl.className = 'bg-light rounded-lg p-3 flex flex-col items-center card-hover';
                itemEl.innerHTML = `
                    <img src="${item.image}" alt="${item.name}" class="w-16 h-16 object-contain mb-2">
                    <h4 class="text-sm font-medium text-center">${item.name}</h4>
                    <div class="flex items-center mt-1">
                        <img src="https://p3-doubao-search-sign.byteimg.com/labis/eafec4e38a23595fa8339e9fb0a32d8a~tplv-be4g95zd3a-image.jpeg?rk3s=542c0f93&x-expires=1779190655&x-signature=1PLNiCri7IDVMQtj%2Bv2T5Ur1tsI%3D" alt="积分" class="w-4 h-4 mr-1">
                        <span class="text-xs">${item.points}</span>
                    </div>
                    <button class="mt-2 px-3 py-1 bg-primary text-white text-xs rounded-full hover:bg-red-700 transition-all-300 ${pomodoroPoints < item.points ? 'opacity-50 cursor-not-allowed' : ''}" 
                            onclick="redeemReward(${item.id})" ${pomodoroPoints < item.points ? 'disabled' : ''}>
                        兑换
                    </button>
                `;
                foodContainer.appendChild(itemEl);
            });
        }
        
        // 渲染已兑换的奖励
        function renderRedeemedRewards() {
            if (rewards.redeemed.length === 0) {
                noRedeemedEl.classList.remove('hidden');
                redeemedListEl.classList.add('hidden');
                return;
            }
            
            noRedeemedEl.classList.add('hidden');
            redeemedListEl.classList.remove('hidden');
            redeemedListEl.innerHTML = '';
            
            rewards.redeemed.forEach(item => {
                const itemEl = document.createElement('div');
                itemEl.className = 'flex items-center justify-between bg-white p-2 rounded mb-2';
                itemEl.innerHTML = `
                    <div class="flex items-center">
                        <img src="${item.image}" alt="${item.name}" class="w-8 h-8 object-contain mr-2">
                        <span>${item.name}</span>
                    </div>
                    <span class="text-xs text-gray-500">${item.date}</span>
                `;
                redeemedListEl.appendChild(itemEl);
            });
        }
        
        // 兑换奖励
        window.redeemReward = function(id) {
            // 查找奖励
            const allRewards = [...rewards.items, ...rewards.food];
            const reward = allRewards.find(item => item.id === id);
            
            if (!reward || pomodoroPoints < reward.points) {
                return;
            }
            
            // 扣除积分
            pomodoroPoints -= reward.points;
            updateStats();
            
            // 添加到已兑换列表
            const redeemedItem = {
                ...reward,
                date: new Date().toLocaleDateString()
            };
            rewards.redeemed.push(redeemedItem);
            
            // 保存已兑换的奖励
            localStorage.setItem('pomodoroRewards', JSON.stringify(rewards.redeemed));
            
            // 更新UI
            renderRewardsStore();
            renderRedeemedRewards();
            
            // 显示成功提示
            successToast.classList.remove('hidden');
            setTimeout(() => {
                successToast.classList.add('hidden');
            }, 3000);
        };
        
        // 打开奖励商店
        function openRewardsModal() {
            rewardsModal.classList.remove('hidden');
            renderRewardsStore();
        }
        
        // 关闭奖励商店
        function closeRewardsModal() {
            rewardsModal.classList.add('hidden');
        }
        
        // 事件监听
        startBtn.addEventListener('click', toggleTimer);
        resetBtn.addEventListener('click', resetTimer);
        workModeBtn.addEventListener('click', () => toggleMode('work'));
        breakModeBtn.addEventListener('click', () => toggleMode('break'));
        workTimeInput.addEventListener('change', updateTimeSettings);
        breakTimeInput.addEventListener('change', updateTimeSettings);
        rewardsBtn.addEventListener('click', openRewardsModal);
        closeRewardsBtn.addEventListener('click', closeRewardsModal);
        
        // 点击模态框外部关闭
        rewardsModal.addEventListener('click', (e) => {
            if (e.target === rewardsModal) {
                closeRewardsModal();
            }
        });
        
        // 初始化
        updateTimerDisplay();
        loadStats();
        loadSettings();
    </script>
</body>
</html>